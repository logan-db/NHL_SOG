# The main pipeline for nhlPredict
resources:
  pipelines:
    NHLPlayerIngestion:
      name: NHLPlayerIngestion
      target: ${bundle.environment}
      continuous: false
      channel: PREVIEW
      photon: true
      libraries:
        - notebook:
            path: ../src/dlt_etl/ingestion/01-bronze-ingestion-nhl-api.py
        - notebook:
            path: ../src/dlt_etl/transformation/02-silver-transform.py
        - notebook:
            path: ../src/dlt_etl/aggregation/03-gold-agg.py
      serverless: true
      catalog: lr_nhl_demo
      configuration:
        bundle.sourcePath: ${workspace.file_path}/src
        # Used by gold fallback when dlt.read() returns 0 (spark.table(catalog.schema.table))
        schema: dev
        catalog: lr_nhl_demo
        one_time_load: "false"            # Incremental mode
        skip_staging_ingestion: "true"    # SKIP MODE - use _staging_manual tables (like last night)
        lookback_days: "1"                # Safety buffer for late-arriving data
        # How many days of future schedule to fetch (default 8). Needed so gold has upcoming NHL games.
        schedule_future_days: "17"
      notifications:
        - email_recipients:
            - logan.rupert@databricks.com
          alerts:
            - on-update-success
            - on-update-failure
            - on-flow-failure
      root_path: /Workspace/Users/logan.rupert@databricks.com/.bundle/nhlPredict/dev/files/src/dlt_etl
